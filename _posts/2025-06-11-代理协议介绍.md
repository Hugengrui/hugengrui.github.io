---
title: 代理协议
date: 2024-06-11 10:00:00 +0800
categories: [技术, 网络]
tags: [代理协议，海外接入]
math: true
---
目前尝试了以下新的代理

1. vmess-httpupgrade

vmess-httpupgrade是一种基于VMess协议的改进版本，它使用HTTP Upgrade机制来建立连接。这种方式可以：

- 更好地伪装成普通HTTP流量，降低被检测的风险
- 通过HTTP升级机制实现更稳定的长连接
- 保持了VMess协议的加密和认证特性
- 在某些网络环境下具有更好的穿透性

主要适用于需要规避检测的场景，但相比普通VMess可能会有轻微的性能开销。

相对于普通的vmess-tls，vmess-h2无优势。使用它的主要场景是最新版本的V2rayNG，这个最新的版本只支持xhttp，所以只能使用它。windows的v2rayNG支持，Linux的v2ray不支持，不论是docker版本和宿主机版本都不支持。目前还未尝试clash是否支持。

1. vless-reality

vless-reality是一种新型的代理协议，它具有以下特点：

- 采用VLESS协议作为基础，更加轻量和高效
- 使用REALITY技术进行TLS伪装，能更好地模拟真实网站的TLS指纹
- 支持多种TLS版本和密码套件，提高兼容性
- 具有双向认证机制，提供更高的安全性
- 可以自定义SNI和服务器名称，增强伪装效果

相比传统的TLS代理，REALITY技术不需要证书，可以有效避免中间人攻击。它适用于对安全性和隐私性要求较高的场景，但配置相对复杂，需要更专业的技术知识。

目前主流的代理客户端都已支持REALITY，包括v2rayN、Xray等。但由于是较新的技术，部分旧版本客户端可能需要更新才能使用。

实际的使用下来也无明显的优势，主要是自己的机器性能比较好，这种轻量级的协议并无太大的优势。v2ray一般都支持，但是要注意clash-premium不支持。

1. hysteria 2

Hysteria 2是一个新开发的代理协议，具有以下特点：

- 基于QUIC协议开发，能够在不稳定网络环境下保持高速连接
- 采用自定义的加密和认证机制，提供更强的安全性
- 支持多路复用，可以同时处理多个连接请求
- 内置流量控制和拥塞控制算法，优化网络性能
- 相比Hysteria 1具有更好的稳定性和更低的延迟

在实际使用中，Hysteria 2表现出以下优势：

1. 在高延迟、高丢包率的网络环境下仍能保持较好的性能
2. 启动速度快，连接建立时间短
3. 资源占用相对较低，适合在各类设备上运行

目前多数现代客户端已支持Hysteria 2，包括Sing-Box等。但需注意的是，某些传统的代理客户端可能尚未支持此协议。另外，由于其使用UDP，在某些网络环境下可能会受到限制。

实际使用下来，sing-box的配置脚本虽然支持Hysteria 2协议的配置，但是要注意没有TLS加密（或者说没有证书验证），这就导致对于一些依赖于TLS才能加载的网站的部件无法加载，例如Gemini的部件，很多都无法使用。而最终生成的链接也只能在各种V2rayNG使用。

实际上，正经的Hysteria 2协议依赖于https://v2.hysteria.network/提供的工具和配置，并配置好证书后才能正常使用，同时可以体会到各种Hysteria 2协议的优势。配置时要注意，服务端必须使用正确的证书路径和私钥路径，客户端也需要拿到证书路径（Windows和Linux）或者证书内容（Android的NekoBox中证书链应该填写以BEGIN-CERTIFICATE开头和END-CERTIFICATE结尾的内容）才能正确连接，同时网页的部件均可正常加载。

证书也应注意，基本都需要使用自签名证书，步骤如下

- 在服务器端生成私钥

```bash
openssl genrsa -out mycert.key 2048
```

- 创建OpenSSL config（包含SANs）

```
[req]
default_bits = 2048
prompt = no
default_md = sha256
distinguished_name = dn
x509_extensions = v3_req

[dn]
C = US
ST = California
L = Santa Clara
O = My Organization
OU = My Unit
CN = yourdomain.com  # 将 yourdomain.com 替换为您的实际域名或 IP 地址

[v3_req]
basicConstraints = CA:FALSE
keyUsage = digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth, clientAuth
subjectAltName = @alt_names

[alt_names]
DNS.1 = yourdomain.com  # 将 yourdomain.com 替换为您的实际域名或 IP 地址
DNS.2 = www.yourdomain.com # 如果需要，添加额外的域名
IP.1 = 127.0.0.1      # 如果需要，添加 IP 地址
# 您可以根据需要添加更多的 DNS 和 IP 条目，例如 DNS.3, IP.2 等
```

- 生成自签名证书

```bash
openssl req -new -key mycert.key -out mycert.csr -config openssl.cnf
openssl x509 -req -days 365 -in mycert.csr -signkey mycert.key -out mycert.crt -extfile openssl.cnf -extensions v3_req
```

将mycert.crt传送至客户端，按照https://v2.hysteria.network/的说明配置好客户端与服务端就可以使用了。

1. TUIC

TUIC (Tuic UDP IP Changer)是一个基于QUIC协议的代理工具，具有以下特点：

- 使用QUIC作为传输层协议，提供可靠的数据传输和低延迟
- 支持0-RTT连接建立，大幅减少初始连接时间
- 内置拥塞控制和流量控制机制，优化网络性能
- 支持多路复用，高效处理并发连接
- 具有较强的抗干扰能力，适合在不稳定网络环境下使用

TUIC的主要优势包括：

1. 快速的连接建立速度，特别是在重连时表现突出
2. 优秀的网络性能和稳定性
3. 资源占用相对较低

目前TUIC已被集成到多个主流客户端中，如sing-box等。但由于其也是基于UDP协议，在某些网络环境下可能会受到限制。配置时需要注意证书的设置，确保TLS加密正常工作。

实际使用经验表明，TUIC在大文件传输和视频流媒体等场景下表现优异，但配置相对复杂，需要较专业的技术知识。同时，由于是较新的协议，部分老旧客户端可能不支持。

由sing-box脚本安装的TUIC目前几乎无法使用，且只能在v2rayNG中使用，且目前来看时基于QUIC协议的，没有明显比hysterica 2的优势。

| 协议 | 主要优势 | 主要缺点 | 适用场景 |
| :--- | :--- | :--- | :--- |
| **vmess-httpupgrade** | <ul><li>更好的流量伪装</li><li>稳定的长连接</li><li>良好的穿透性</li></ul> | <ul><li>轻微性能开销</li><li>部分客户端不支持</li><li>Linux版v2ray不支持</li></ul> | 需要规避检测的环境，特别是使用最新版 V2rayNG 的用户。 |
| **vless-reality** | <ul><li>轻量高效</li><li>无需证书</li><li>更好的TLS伪装</li><li>双向认证</li></ul> | <ul><li>配置较复杂</li><li>clash-premium 不支持</li><li>需要专业技术知识</li></ul> | 对安全性和隐私性要求较高的场景，但机器性能不是主要考虑因素。 |
| **hysteria 2** | <ul><li>高速连接</li><li>支持多路复用</li><li>资源占用低</li><li>启动速度快</li></ul> | <ul><li>需要正确配置证书</li><li>配置复杂</li><li>部分传统客户端不支持</li><li>UDP 可能受限</li></ul> | 高延迟、高丢包率的网络环境，需要稳定性和低延迟的场景。 |
| **TUIC** | <ul><li>快速连接建立</li><li>优秀的网络性能</li><li>资源占用低</li><li>支持 0-RTT</li></ul> | <ul><li>配置复杂</li><li>sing-box 脚本版难用</li><li>UDP 可能受限</li><li>客户端支持有限</li></ul> | 大文件传输和视频流媒体场景，但目前相比 hysteria 2 无明显优势。 |

